import{f as H,a as J,i as K,b as Q,d as q,p as W,_ as X}from"./index-ba2d1bbd.js";import{d as D,r as B,o as U,e as z,f as e,j as t,k as i,F as Y,g as Z,v as M,G as ee,H as oe,I as $,J as G,K as R,L as te,a as j,c as se,w as ae,M as ne,t as m,u as g,N as le,O as ie,P as ce,y as de,z as _e,Q as A,R as re}from"./element-plus-5455aaa7.js";const ue={class:"config"},me=e("h2",null,"转换配置:",-1),pe={class:"operate"},ve=D({__name:"Transcoding",props:{onFinish:{type:Function}},setup(p){const o=p,f=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","rm","rmvb","f4v"],n=B({format:"mp4",kbps:1e3});function w(){o.onFinish(n)}return(h,a)=>{const d=ee,V=oe,b=$,y=G,k=R,E=te;return U(),z("div",null,[e("div",ue,[me,t(k,{"label-position":"left","label-width":"100px",model:n},{default:i(()=>[t(b,{label:"输出格式"},{default:i(()=>[t(V,{filterable:"",modelValue:n.format,"onUpdate:modelValue":a[0]||(a[0]=s=>n.format=s),placeholder:"请选择"},{default:i(()=>[(U(),z(Y,null,Z(f,s=>t(d,{key:s,label:s,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"码率"},{default:i(()=>[t(y,{placeholder:"请输入",modelValue:n.kbps,"onUpdate:modelValue":a[1]||(a[1]=s=>n.kbps=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),e("div",pe,[t(E,{type:"primary",onClick:w},{default:i(()=>[M(" 输出 ")]),_:1})])])}}}),c=p=>(de("data-v-c516d706"),p=p(),_e(),p),fe=["element-loading-text"],he={class:"info"},be=c(()=>e("h2",null,"基本信息:",-1)),ge={class:"row"},we=c(()=>e("div",{class:"label"},"文件名:",-1)),Fe={class:"value"},xe={class:"row"},Ve=c(()=>e("div",{class:"label"},"文件大小:",-1)),ye={class:"value"},ke={class:"row"},Ee=c(()=>e("div",{class:"label"},"视频时长:",-1)),Te={class:"value"},Ie={class:"row"},Se=c(()=>e("div",{class:"label"},"解码器:",-1)),Le={class:"value"},Ne={class:"row"},Ae={class:"label"},Be={class:"value"},Ue={class:"info"},ze=c(()=>e("h2",null,"视频流信息:",-1)),Ce={class:"row"},Oe=c(()=>e("div",{class:"label"},"文件名:",-1)),Pe={class:"value"},je={class:"info"},De=c(()=>e("h2",null,"音频流信息:",-1)),Me={class:"row"},$e=c(()=>e("div",{class:"label"},"文件名:",-1)),Ge={class:"value"},Re={class:"config"},He=c(()=>e("h2",null,"通用导出配置:",-1)),Je={class:"operate"},Ke=D({__name:"Video",setup(p){let o=null,f="";const n=B({name:"output"}),w=j("transcoding"),h=j({audio:{},video:{code:"",format:""},basic:{duration:0,bitrate:0,encoder:"",majorBrand:""}}),a=B({value:!1,text:"Loading"}),d=se(()=>J.value[0]);async function V(){a.value=!0,a.text="初始化编解码器中...",o=await K(),a.value=!1}ae(d,async()=>{d.value&&(f&&(o==null||o.FS("unlink",f)),await b())});async function b(){a.value=!0,a.text="获取视频信息中...";const s=d.value,v=await Q(s.raw),F=[];o==null||o.FS("writeFile",s.name,v),f=s.name,o==null||o.setLogger(({type:u,message:_})=>{u!=="ffout"&&F.push(_)}),o==null||o.setProgress(u=>{console.log("%c [ t ]-82","font-size:13px; background:pink; color:#bf2c9f;",u)}),await(o==null?void 0:o.run("-i",s.name,"-f","ffmetadata","-c","copy","-map_metadata","0","-map_metadata:s:v","0:s:v","FFMETADATAFILE"));const T=o==null?void 0:o.FS("readFile","FFMETADATAFILE");q(T,`
  text/plain;charset=utf-8
  `,"t.txt");const r=W(F);if(console.log(r),r.length===0)A.error({title:"错误",message:"获取视频信息失败"});else{A.success({title:"成功",message:"获取视频信息成功"});const{duration:u,encoder:_,majorBrand:I}=r[0]??{},{duration:S,bitrate:x}=u??{};h.value.basic={duration:S,bitrate:x,encoder:_,majorBrand:I},r.find(l=>(l==null?void 0:l.handlerName)==="videohandler")||A.error({title:"错误",message:"获取视频流信息失败"}),r.find(l=>(l==null?void 0:l.handlerName)==="soundhandler")}a.value=!1}async function y(){console.log("初始化编码器"),await V(),await b()}y();function k(){}function E(s){console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",s)}return(s,v)=>{var x,L,l,C,O,P;const F=le,T=G,r=$,u=R,_=re,I=ie,S=ce;return ne((U(),z("div",{class:"video","element-loading-text":a.text},[e("div",he,[be,e("div",ge,[we,e("div",Fe,m(g(d).name),1)]),e("div",xe,[Ve,e("div",ye,m(g(H)(g(d).size)),1)]),e("div",ke,[Ee,e("div",Te,m((L=(x=h.value)==null?void 0:x.basic)==null?void 0:L.duration),1)]),e("div",Ie,[Se,e("div",Le,m((C=(l=h.value)==null?void 0:l.basic)==null?void 0:C.encoder),1)]),e("div",Ne,[e("div",Ae,[t(F,{content:"详见 http://ftyps.com/"},{default:i(()=>[M(" ftyp: ")]),_:1})]),e("div",Be,m((P=(O=h.value)==null?void 0:O.basic)==null?void 0:P.majorBrand),1)])]),e("div",Ue,[ze,e("div",Ce,[Oe,e("div",Pe,m(g(d).name),1)])]),e("div",je,[De,e("div",Me,[$e,e("div",Ge,m(g(d).name),1)])]),e("div",Re,[He,t(u,{"label-position":"left","label-width":"100px",model:n},{default:i(()=>[t(r,{label:"输出名称"},{default:i(()=>[t(T,{placeholder:"请输入",modelValue:n.name,"onUpdate:modelValue":v[0]||(v[0]=N=>n.name=N)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),e("div",Je,[t(I,{modelValue:w.value,"onUpdate:modelValue":v[1]||(v[1]=N=>w.value=N),onTabClick:k},{default:i(()=>[t(_,{name:"transcoding",label:"转换"},{default:i(()=>[t(ve,{"on-finish":E})]),_:1}),t(_,{name:"Config",label:"提取字幕"}),t(_,{name:"Role",label:"提取音频"}),t(_,{name:"waterMark",label:"水印"})]),_:1},8,["modelValue"])])],8,fe)),[[S,a.value]])}}});const We=X(Ke,[["__scopeId","data-v-c516d706"]]);export{We as default};
