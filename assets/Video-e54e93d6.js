var X=Object.defineProperty;var Y=(_,o,e)=>o in _?X(_,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[o]=e;var x=(_,o,e)=>(Y(_,typeof o!="symbol"?o+"":o,e),e);import{_ as Z,i as ee,a as j,b as m,T as le,o as ae,g as te,d as oe,c as N,f as ne,e as se,h as re,j as ce,k as ie}from"./index-846f46b9.js";import{m as D,c as A,_ as q,$ as de,k as f,l as $,F as R,f as l,q as s,C as k,p as B,v as z,a0 as ue,a1 as pe,D as E,B as M,a2 as W,a3 as me,y as U,A as G,a4 as fe,a5 as _e,j as ge,a6 as be,a7 as H,a8 as J,a9 as ve,aa as he,ab as K,ac as we,r as S,w as $e,V as Ve,ad as ye,ae as ke,U as Ee,af as Fe}from"./element-plus-c8ced09d.js";const w=class w{static async init(){if(w.instance)return w.instance;{const{createFFmpeg:o}=await Z(()=>import("./index-972a59ba.js").then(d=>d.i),["assets/index-972a59ba.js","assets/element-plus-c8ced09d.js"]),e=o({log:!0,progress:d=>{console.log(d)},workerPath:new URL("/format-factory/assets/ffmpeg-core.worker-dce31a8d.js",self.location).href,corePath:new URL("/format-factory/assets/ffmpeg-core-d22dfcb4.js",self.location).href,wasmPath:new URL("/format-factory/assets/ffmpeg-core-8d85fba8.wasm",self.location).href});return await e.load(),w.instance=e,e}}getInstance(){return w.instance}static destoryFfmpeg(){var o;(o=w.instance)==null||o.exit(),w.instance=null}};x(w,"instance",null);let O=w;const Pe={class:"mask"},Le={key:0,class:"percentage-value"},Te={key:2,class:"percentage-label"},Ue={class:"tip"},Ie=D({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:{},text:{},percentageLabel:{},tip:{}},setup(_){const o=_,e=A(()=>!ee(o.percentage)),d=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(g,a)=>{const n=W,i=me;return q((f(),$("div",Pe,[e.value?(f(),$(R,{key:0},[l(i,{type:"dashboard",percentage:g.percentage,color:d},{default:s(({percentage:c})=>[c<100?(f(),$("span",Le,k(c)+"%",1)):(f(),B(n,{key:1,type:"success",icon:z(ue),circle:""},null,8,["icon"])),g.percentageLabel?(f(),$("span",Te,k(g.percentageLabel),1)):pe("",!0)]),_:1},8,["percentage"]),E("div",Ue,k(g.tip),1)],64)):(f(),$(R,{key:1},[M("加载中")],64))],512)),[[de,g.loading]])}}});const Re=j(Ie,[["__scopeId","data-v-5de5031d"]]);const Ce=[{label:m.global.t("ultrafast"),value:"ultrafast"},{label:m.global.t("superfast"),value:"superfast"},{label:m.global.t("veryfast"),value:"veryfast"},{label:m.global.t("faster"),value:"faster"},{label:m.global.t("fast"),value:"fast"},{label:m.global.t("medium"),value:"medium"},{label:m.global.t("slow"),value:"slow"},{label:m.global.t("slower"),value:"slower"},{label:m.global.t("veryslow"),value:"veryslow"}],Ne=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],Se={class:"config"},Ae={class:"operate"},Be=D({__name:"Transcoding",props:{encoder:{},file:{},config:{}},setup(_){const o=_,e=U({format:"mp4",kbps:1e3,frameRate:60,width:1920,height:1080,resolution:1080,black:!1,preset:"medium"}),d=U({loading:!1,percentage:0,text:"",tip:""});async function g(){var a,n,i;try{const c=new le(1e3);c.start(V=>{const b=Number((V*(100-d.percentage)/d.percentage/1e3).toFixed(0));d.tip=`已耗时${V/1e3}秒,预计还需${b}秒`}),d.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",c),(a=o.encoder)==null||a.setProgress(V=>{const{ratio:b}=V;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",V),b>=1&&!V.duration&&(c.stop(),d.tip="转码已完成,正在执行导出操作...");const C=Number((b*100).toFixed(1));d.percentage=C});const{format:p,frameRate:v,width:F,height:P,resolution:L,kbps:r,black:u,preset:t}=e,y=ae({"-i":o.file.name,"-r":`${v}`,"-s":`${F}x${P}`,"-vf":`scale=${L}:-1${u?"":" ,hue=s=0"}`,"-b":`${r}k`,"-preset":t}),h=`${te(o.config.name)}.${p.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",e),await((n=o.encoder)==null?void 0:n.run(...y,h));const I=(i=o.encoder)==null?void 0:i.FS("readFile",h);if(!I)throw new Error("转换失败");oe(I,"video/mp4",h)}catch(c){console.error(c),ge({message:"转换失败",type:"error"})}d.loading=!1,d.tip=""}return(a,n)=>{const i=we,c=be,p=H,v=J,F=ve,P=he,L=K,r=W,u=Re;return f(),$("div",null,[E("div",Se,[E("h2",null,k(a.$t("trans_config"))+":",1),l(L,{"label-position":"left","label-width":"100px",model:e},{default:s(()=>[l(p,{label:a.$t("output_format")},{default:s(()=>[l(c,{modelValue:e.format,"onUpdate:modelValue":n[0]||(n[0]=t=>e.format=t),filterable:"",placeholder:a.$t("select_placeholder")},{default:s(()=>[(f(!0),$(R,null,G(z(Ne),t=>(f(),B(i,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("code_rate")},{default:s(()=>[l(v,{modelValue:e.kbps,"onUpdate:modelValue":n[1]||(n[1]=t=>e.kbps=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("FrameRate")},{default:s(()=>[l(v,{modelValue:e.frameRate,"onUpdate:modelValue":n[2]||(n[2]=t=>e.frameRate=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("width")},{default:s(()=>[l(v,{modelValue:e.width,"onUpdate:modelValue":n[3]||(n[3]=t=>e.width=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("height")},{default:s(()=>[l(v,{modelValue:e.height,"onUpdate:modelValue":n[4]||(n[4]=t=>e.height=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("resolution")},{default:s(()=>[l(v,{modelValue:e.resolution,"onUpdate:modelValue":n[5]||(n[5]=t=>e.resolution=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("is_black")},{default:s(()=>[l(F,{modelValue:e.black,"onUpdate:modelValue":n[6]||(n[6]=t=>e.black=t),placeholder:a.$t("select_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("output_speed")},{label:s(()=>[l(P,{content:a.$t("output_speed_tip")},{default:s(()=>[M(k(a.$t("output_speed")),1)]),_:1},8,["content"])]),default:s(()=>[l(c,{modelValue:e.preset,"onUpdate:modelValue":n[7]||(n[7]=t=>e.preset=t),placeholder:a.$t("select_placeholder")},{default:s(()=>[(f(!0),$(R,null,G(z(Ce),t=>(f(),B(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),E("div",Ae,[l(r,{type:"primary",onClick:g},{default:s(()=>[M(k(a.$t("output")),1)]),_:1})]),l(u,fe(_e(d)),null,16)])}}});const ze=j(Be,[["__scopeId","data-v-c26115fd"]]),Me=["element-loading-text"],Oe={class:"config"},je={class:"operate"},De=D({__name:"Video",setup(_){const o=U({name:m.global.t("output")}),e=S(null),d=S("transcoding"),g=S("-1"),a=U({audio:{},video:{},basic:{}}),n=A(()=>({file_n:c.value.name,file_s:ne(c.value.size),...a.basic})),i=U({value:!1,text:"Loading"}),c=A(()=>se.value[0]);async function p(){i.value=!0,i.text="初始化编解码器中...",e.value=await O.init(),e==null||e.value.setLogger(({type:r,message:u})=>{console.log(r,u)}),i.value=!1}$e(c,async()=>{c.value&&(await F(),await v())},{immediate:!0});async function v(){var u;i.value=!0,i.text="正在读取文件...";const r=await re(c.value.raw);(u=e.value)==null||u.FS("writeFile",c.value.name,r),console.log("视频已读入ffmpeg"),i.value=!1}async function F(){i.value=!0,i.text="获取视频信息中...";const{raw:r}=c.value,u=await ce(r);for(const t of u.media.track){const{"@type":y,...h}=t;y==="Video"?a.video={...h,"@type":m.global.t("video")}:y==="Audio"?a.audio={...h,"@type":m.global.t("audio")}:y==="General"&&(a.basic=h)}await ie(()=>!!e.value),i.value=!1}async function P(){await p()}function L(){console.log(123)}return P(),(r,u)=>{const t=Ee,y=Ve,h=J,I=H,V=K,b=Fe,C=ye,Q=ke;return q((f(),$("div",{class:"video","element-loading-text":i.text},[l(y,{modelValue:g.value,"onUpdate:modelValue":u[0]||(u[0]=T=>g.value=T)},{default:s(()=>[l(t,{title:r.$t("basic_info"),name:"1"},{default:s(()=>[l(N,{data:n.value},null,8,["data"])]),_:1},8,["title"]),l(t,{title:r.$t("video_info"),name:"2"},{default:s(()=>[l(N,{data:a.video},null,8,["data"])]),_:1},8,["title"]),l(t,{title:r.$t("audio_info"),name:"3"},{default:s(()=>[l(N,{data:a.audio},null,8,["data"])]),_:1},8,["title"])]),_:1},8,["modelValue"]),E("div",Oe,[E("h2",null,k(r.$t("common_config"))+":",1),l(V,{"label-position":"left","label-width":"100px",model:o},{default:s(()=>[l(I,{label:r.$t("output_name")},{default:s(()=>[l(h,{modelValue:o.name,"onUpdate:modelValue":u[1]||(u[1]=T=>o.name=T),placeholder:r.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),E("div",je,[l(C,{modelValue:d.value,"onUpdate:modelValue":u[2]||(u[2]=T=>d.value=T),onTabClick:L},{default:s(()=>[l(b,{name:"transcoding",label:r.$t("trans")},{default:s(()=>[l(ze,{config:o,encoder:e.value,file:c.value},null,8,["config","encoder","file"])]),_:1},8,["label"]),l(b,{name:"Config",label:r.$t("extract_sub")},null,8,["label"]),l(b,{name:"Role",label:r.$t("extract_audio")},null,8,["label"]),l(b,{name:"waterMark",label:r.$t("watermark")},null,8,["label"]),l(b,{name:"screenshot",label:r.$t("screenshot")},null,8,["label"])]),_:1},8,["modelValue"])])],8,Me)),[[Q,i.value]])}}});const We=j(De,[["__scopeId","data-v-a7a3f8f4"]]);export{We as default};
