import{i as H,_ as M,a as m,T as J,o as K,g as Q,d as X,b as S,f as Y,c as ee,e as le,h as ae,j as oe,k as te}from"./index-320c5441.js";import{m as O,c as R,Z as G,_ as ne,k as _,l as h,F as P,f as e,q as n,B as w,p as z,v as B,$ as se,a0 as re,C as k,A,a1 as j,a2 as de,x as C,z as x,a3 as ie,a4 as ue,j as ce,a5 as pe,a6 as D,a7 as q,a8 as me,a9 as _e,aa as W,ab as fe,r as L,w as ge,U as be,ac as ve,ad as he,S as $e,ae as Ve}from"./element-plus-4b48ede0.js";const we={class:"mask"},ke={key:0,class:"percentage-value"},ye={key:2,class:"percentage-label"},Fe={class:"tip"},Ee=O({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:{},text:{},percentageLabel:{},tip:{}},setup(U){const c=U,o=R(()=>!H(c.percentage)),u=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(f,l)=>{const t=j,d=de;return G((_(),h("div",we,[o.value?(_(),h(P,{key:0},[e(d,{type:"dashboard",percentage:f.percentage,color:u},{default:n(({percentage:r})=>[r<100?(_(),h("span",ke,w(r)+"%",1)):(_(),z(t,{key:1,type:"success",icon:B(se),circle:""},null,8,["icon"])),f.percentageLabel?(_(),h("span",ye,w(f.percentageLabel),1)):re("",!0)]),_:1},8,["percentage"]),k("div",Fe,w(f.tip),1)],64)):(_(),h(P,{key:1},[A("加载中")],64))],512)),[[ne,f.loading]])}}});const Te=M(Ee,[["__scopeId","data-v-5de5031d"]]);const Ue=[{label:m.global.t("ultrafast"),value:"ultrafast"},{label:m.global.t("superfast"),value:"superfast"},{label:m.global.t("veryfast"),value:"veryfast"},{label:m.global.t("faster"),value:"faster"},{label:m.global.t("fast"),value:"fast"},{label:m.global.t("medium"),value:"medium"},{label:m.global.t("slow"),value:"slow"},{label:m.global.t("slower"),value:"slower"},{label:m.global.t("veryslow"),value:"veryslow"}],Ie=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],Le={class:"config"},Pe={class:"operate"},Ce=O({__name:"Transcoding",props:{encoder:{},file:{},config:{}},setup(U){const c=U,o=C({format:"mp4",kbps:1e3,frameRate:60,width:1920,height:1080,resolution:1080,black:!1,preset:"medium"}),u=C({loading:!1,percentage:0,text:"",tip:""});async function f(){var l,t,d;try{const r=new J(1e3);r.start($=>{const g=Number(($*(100-u.percentage)/u.percentage/1e3).toFixed(0));u.tip=`已耗时${$/1e3}秒,预计还需${g}秒`}),u.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",r),(l=c.encoder)==null||l.setProgress($=>{const{ratio:g}=$;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",$),g>=1&&!$.duration&&(r.stop(),u.tip="转码已完成,正在执行导出操作...");const N=Number((g*100).toFixed(1));u.percentage=N});const{format:p,frameRate:b,width:y,height:F,resolution:E,kbps:s,black:i,preset:a}=o,V=K({"-i":c.file.name,"-r":`${b}`,"-s":`${y}x${F}`,"-vf":`scale=${E}:-1${i?"":" ,hue=s=0"}`,"-b":`${s}k`,"-preset":a}),v=`${Q(c.config.name)}.${p.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",o),await((t=c.encoder)==null?void 0:t.run(...V,v));const I=(d=c.encoder)==null?void 0:d.FS("readFile",v);if(!I)throw new Error("转换失败");X(I,"video/mp4",v)}catch(r){console.error(r),ce({message:"转换失败",type:"error"})}u.loading=!1,u.tip=""}return(l,t)=>{const d=fe,r=pe,p=D,b=q,y=me,F=_e,E=W,s=j,i=Te;return _(),h("div",null,[k("div",Le,[k("h2",null,w(l.$t("trans_config"))+":",1),e(E,{"label-position":"left","label-width":"100px",model:o},{default:n(()=>[e(p,{label:l.$t("output_format")},{default:n(()=>[e(r,{modelValue:o.format,"onUpdate:modelValue":t[0]||(t[0]=a=>o.format=a),filterable:"",placeholder:l.$t("select_placeholder")},{default:n(()=>[(_(!0),h(P,null,x(B(Ie),a=>(_(),z(d,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("code_rate")},{default:n(()=>[e(b,{modelValue:o.kbps,"onUpdate:modelValue":t[1]||(t[1]=a=>o.kbps=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("FrameRate")},{default:n(()=>[e(b,{modelValue:o.frameRate,"onUpdate:modelValue":t[2]||(t[2]=a=>o.frameRate=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("width")},{default:n(()=>[e(b,{modelValue:o.width,"onUpdate:modelValue":t[3]||(t[3]=a=>o.width=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("height")},{default:n(()=>[e(b,{modelValue:o.height,"onUpdate:modelValue":t[4]||(t[4]=a=>o.height=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("resolution")},{default:n(()=>[e(b,{modelValue:o.resolution,"onUpdate:modelValue":t[5]||(t[5]=a=>o.resolution=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("is_black")},{default:n(()=>[e(y,{modelValue:o.black,"onUpdate:modelValue":t[6]||(t[6]=a=>o.black=a),placeholder:l.$t("select_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("output_speed")},{label:n(()=>[e(F,{content:l.$t("output_speed_tip")},{default:n(()=>[A(w(l.$t("output_speed")),1)]),_:1},8,["content"])]),default:n(()=>[e(r,{modelValue:o.preset,"onUpdate:modelValue":t[7]||(t[7]=a=>o.preset=a),placeholder:l.$t("select_placeholder")},{default:n(()=>[(_(!0),h(P,null,x(B(Ue),a=>(_(),z(d,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),k("div",Pe,[e(s,{type:"primary",onClick:f},{default:n(()=>[A(w(l.$t("output")),1)]),_:1})]),e(i,ie(ue(u)),null,16)])}}});const Ne=M(Ce,[["__scopeId","data-v-c26115fd"]]),Se=["element-loading-text"],Re={class:"config"},ze={class:"operate"},Be=O({__name:"Video",setup(U){const c=C({name:m.global.t("output")}),o=L(null),u=L("transcoding"),f=L("-1"),l=L({audio:{},video:{},basic:{}}),t=R(()=>({file_n:r.value.name,file_s:Y(r.value.size),...l.value.basic})),d=C({value:!1,text:"Loading"}),r=R(()=>ee.value[0]);async function p(){d.value=!0,d.text="初始化编解码器中...",o.value=await le(),o==null||o.value.setLogger(({type:s,message:i})=>{console.log(s,i)}),d.value=!1}ge(r,async()=>{r.value&&(await y(),await b())},{immediate:!0});async function b(){var i;d.value=!0,d.text="正在读取文件...";const s=await ae(r.value.raw);(i=o.value)==null||i.FS("writeFile",r.value.name,s),console.log("视频已读入ffmpeg"),d.value=!1}async function y(){d.value=!0,d.text="获取视频信息中...";const{raw:s}=r.value,i=await oe(s);for(const a of i.media.track){const{"@type":V,...v}=a;V==="Video"?l.value.video={...v,"@type":m.global.t("video")}:V==="Audio"?l.value.audio={...v,"@type":m.global.t("audio")}:V==="General"&&(l.value.basic=v)}await te(()=>!!o.value),d.value=!1}async function F(){await p()}function E(){console.log(123)}return F(),(s,i)=>{const a=$e,V=be,v=q,I=D,$=W,g=Ve,N=ve,Z=he;return G((_(),h("div",{class:"video","element-loading-text":d.text},[e(V,{modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=T=>f.value=T)},{default:n(()=>[e(a,{title:s.$t("basic_info"),name:"1"},{default:n(()=>[e(S,{data:t.value},null,8,["data"])]),_:1},8,["title"]),e(a,{title:s.$t("video_info"),name:"2"},{default:n(()=>[e(S,{data:l.value.video},null,8,["data"])]),_:1},8,["title"]),e(a,{title:s.$t("audio_info"),name:"3"},{default:n(()=>[e(S,{data:l.value.audio},null,8,["data"])]),_:1},8,["title"])]),_:1},8,["modelValue"]),k("div",Re,[k("h2",null,w(s.$t("common_config"))+":",1),e($,{"label-position":"left","label-width":"100px",model:c},{default:n(()=>[e(I,{label:s.$t("output_name")},{default:n(()=>[e(v,{modelValue:c.name,"onUpdate:modelValue":i[1]||(i[1]=T=>c.name=T),placeholder:s.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),k("div",ze,[e(N,{modelValue:u.value,"onUpdate:modelValue":i[2]||(i[2]=T=>u.value=T),onTabClick:E},{default:n(()=>[e(g,{name:"transcoding",label:s.$t("trans")},{default:n(()=>[e(Ne,{config:c,encoder:o.value,file:r.value},null,8,["config","encoder","file"])]),_:1},8,["label"]),e(g,{name:"Config",label:s.$t("extract_sub")},null,8,["label"]),e(g,{name:"Role",label:s.$t("extract_audio")},null,8,["label"]),e(g,{name:"waterMark",label:s.$t("watermark")},null,8,["label"]),e(g,{name:"screenshot",label:s.$t("screenshot")},null,8,["label"])]),_:1},8,["modelValue"])])],8,Se)),[[Z,d.value]])}}});const Oe=M(Be,[["__scopeId","data-v-6703a99f"]]);export{Oe as default};
