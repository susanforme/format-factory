import{_ as E,f as M,a as O,i as P,b as G,g as K,o as k,c as C,e as Q,d as W,h as X,j as Y,k as Z}from"./index-76dacdfb.js";import{l as L,v as I,j as z,k as T,B as _,f as e,p as t,F as q,y as H,z as J,X as ee,Y as U,Z as N,_ as B,$ as ae,a0 as oe,r as S,c as $,w as te,a1 as le,Q as ne,a2 as se,a3 as ie,u as ce,K as de,L as ue,a4 as me,P as re,a5 as _e}from"./element-plus-9926c898.js";const pe={class:"config"},fe=_("h2",null,"转换配置:",-1),ve={class:"operate"},be=L({__name:"Transcoding",props:{onFinish:{type:Function}},setup(r){const p=r,o=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],n=I({format:"mp4",kbps:1e3,frameRate:60});function w(){p.onFinish(n)}return(m,d)=>{const l=oe,s=ee,f=U,F=N,h=B,x=ae;return z(),T("div",null,[_("div",pe,[fe,e(h,{"label-position":"left","label-width":"100px",model:n},{default:t(()=>[e(f,{label:"输出格式"},{default:t(()=>[e(s,{modelValue:n.format,"onUpdate:modelValue":d[0]||(d[0]=i=>n.format=i),filterable:"",placeholder:"请选择"},{default:t(()=>[(z(),T(q,null,H(o,i=>e(l,{key:i,label:i,value:i},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"码率"},{default:t(()=>[e(F,{modelValue:n.kbps,"onUpdate:modelValue":d[1]||(d[1]=i=>n.kbps=i),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(f,{label:"帧率"},{default:t(()=>[e(F,{modelValue:n.frameRate,"onUpdate:modelValue":d[2]||(d[2]=i=>n.frameRate=i),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_("div",ve,[e(x,{type:"primary",onClick:w},{default:t(()=>[J(" 输出 ")]),_:1})])])}}}),ge=r=>(de("data-v-534db76b"),r=r(),ue(),r),we=["element-loading-text"],Fe={class:"config"},Ve=ge(()=>_("h2",null,"通用导出配置:",-1)),he={class:"operate"},xe=L({__name:"Video",setup(r){const p=I({name:"output"});let o=null;const n=S("transcoding"),w=S("-1"),m=S({audio:{},video:{},basic:{}}),d=$(()=>({file_n:s.value.name,file_s:M(s.value.size),...m.value.basic})),l=I({value:!1,text:"Loading"}),s=$(()=>O.value[0]);async function f(){l.value=!0,l.text="初始化编解码器中...",o=await P(),o.setLogger(({type:u,message:a})=>{console.log(u,a)}),l.value=!1}te(s,async()=>{s.value&&(await h(),await F())},{immediate:!0});async function F(){l.value=!0,l.text="正在读取文件...";const u=await G(s.value.raw);o==null||o.FS("writeFile",s.value.name,u),console.log("视频已读入ffmpeg"),l.value=!1}async function h(){l.value=!0,l.text="获取视频信息中...",(await K(s.value.raw)).media.track.forEach(a=>{const c=a["@type"];c==="Video"?m.value.video={...k(a,["FileSize","DataSize"]),"@type":C.global.t("video")}:c==="Audio"?m.value.audio={...k(a,["FileSize","DataSize"]),"@type":C.global.t("audio")}:c==="General"&&(m.value.basic=k(a,["FileSize","DataSize"]))}),await Q(()=>!!o),l.value=!1}async function x(){await f()}function i(){console.log(123)}async function R(u){try{const{format:a,frameRate:c}=u,y=W({"-i":s.value.name,"-r":`${c}`,"-s":"1920x1080","-b":"1000k","-vf":"hue=s=0","-an":"","-preset":"1"}),v=`${X(s.value.name)}.${a.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",u),await(o==null?void 0:o.run(...y,v));const V=o==null?void 0:o.FS("readFile",v);if(!V)throw new Error("转换失败");Y(V,"video/mp4",v)}catch(a){console.log("%c [ error ]-156","font-size:13px; background:pink; color:#bf2c9f;",a),me({message:"转换失败",type:"error"})}}return x(),(u,a)=>{const c=re,y=ne,v=N,V=U,A=B,b=_e,D=se,j=ie;return le((z(),T("div",{class:"video","element-loading-text":l.text},[e(y,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=g=>w.value=g)},{default:t(()=>[e(c,{title:"基本信息",name:"1"},{default:t(()=>[e(E,{data:ce(d)},null,8,["data"])]),_:1}),e(c,{title:"视频流信息",name:"2"},{default:t(()=>[e(E,{data:m.value.video},null,8,["data"])]),_:1}),e(c,{title:"音频流信息",name:"3"},{default:t(()=>[e(E,{data:m.value.audio},null,8,["data"])]),_:1})]),_:1},8,["modelValue"]),_("div",Fe,[Ve,e(A,{"label-position":"left","label-width":"100px",model:p},{default:t(()=>[e(V,{label:"输出名称"},{default:t(()=>[e(v,{modelValue:p.name,"onUpdate:modelValue":a[1]||(a[1]=g=>p.name=g),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_("div",he,[e(D,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=g=>n.value=g),onTabClick:i},{default:t(()=>[e(b,{name:"transcoding",label:"转换"},{default:t(()=>[e(be,{"on-finish":R})]),_:1}),e(b,{name:"Config",label:"提取字幕"}),e(b,{name:"Role",label:"提取音频"}),e(b,{name:"waterMark",label:"水印"}),e(b,{name:"screenshot",label:"截图"})]),_:1},8,["modelValue"])])],8,we)),[[j,l.value]])}}});const ke=Z(xe,[["__scopeId","data-v-534db76b"]]);export{ke as default};
