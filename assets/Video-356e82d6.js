import{i as q,_ as D,a as T,f as H,b as J,c as ee,d as ae,g as te,o as N,e as A,h as oe,T as le,j as ne,k as se,l as ce}from"./index-d20b7353.js";import{l as R,r as E,w as j,c as C,X as M,Y as ie,j as m,k as g,u as U,F as B,f as e,p as n,A as P,m as re,Z as de,_ as ue,B as v,z as O,$ as G,a0 as pe,v as S,y as _e,a1 as me,a2 as K,a3 as Q,a4 as W,a5 as fe,a6 as ge,a7 as ve,Q as be,a8 as he,a9 as ye,K as we,L as xe,aa as Fe,P as Ve,ab as ke}from"./element-plus-7482c9d6.js";const Ee={class:"mask"},Se={key:0,class:"percentage-value"},$e={key:2,class:"percentage-label"},Ie={class:"tip"},Le=R({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:null,text:null,percentageLabel:null,tip:null},setup(i){const d=i,a=E(!1);j(()=>d.loading,()=>{d.loading&&(a.value=!0),setTimeout(()=>{d.loading||(a.value=!1)},1e3)},{immediate:!0});const c=C(()=>!q(d.percentage)),b=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(u,s)=>{const y=G,l=pe;return M((m(),g("div",Ee,[U(c)?(m(),g(B,{key:0},[e(l,{type:"dashboard",percentage:i.percentage,color:b},{default:n(({percentage:o})=>[o<100?(m(),g("span",Se,P(o)+"%",1)):(m(),re(y,{key:1,type:"success",icon:U(de),circle:""},null,8,["icon"])),i.percentageLabel?(m(),g("span",$e,P(i.percentageLabel),1)):ue("",!0)]),_:1},8,["percentage"]),v("div",Ie,P(i.tip),1)],64)):(m(),g(B,{key:1},[O("加载中")],64))],512)),[[ie,a.value]])}}});const ze=D(Le,[["__scopeId","data-v-d78ca4be"]]);const Te={class:"config"},Ne=v("h2",null,"转换配置:",-1),Pe={class:"operate"},Ce=R({__name:"Transcoding",props:{onFinish:{type:Function}},setup(i){const d=i,a=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],c=S({format:"mp4",kbps:1e3,frameRate:60});function b(){d.onFinish(c)}return(u,s)=>{const y=fe,l=me,o=K,F=Q,$=W,I=G;return m(),g("div",null,[v("div",Te,[Ne,e($,{"label-position":"left","label-width":"100px",model:c},{default:n(()=>[e(o,{label:"输出格式"},{default:n(()=>[e(l,{modelValue:c.format,"onUpdate:modelValue":s[0]||(s[0]=r=>c.format=r),filterable:"",placeholder:"请选择"},{default:n(()=>[(m(),g(B,null,_e(a,r=>e(y,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"码率"},{default:n(()=>[e(F,{modelValue:c.kbps,"onUpdate:modelValue":s[1]||(s[1]=r=>c.kbps=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(o,{label:"帧率"},{default:n(()=>[e(F,{modelValue:c.frameRate,"onUpdate:modelValue":s[2]||(s[2]=r=>c.frameRate=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),v("div",Pe,[e(I,{type:"primary",onClick:b},{default:n(()=>[O(" 输出 ")]),_:1})])])}}}),Ue=i=>(we("data-v-ca572197"),i=i(),xe(),i),Be=["element-loading-text"],Re={class:"config"},Ae=Ue(()=>v("h2",null,"通用导出配置:",-1)),De={class:"operate"},je=R({__name:"Video",setup(i){const d=S({name:"output"});let a=null;const c=E("transcoding"),b=E("-1"),u=S({loading:!1,percentage:0,text:"",tip:""}),s=E({audio:{},video:{},basic:{}}),y=C(()=>({file_n:o.value.name,file_s:H(o.value.size),...s.value.basic})),l=S({value:!1,text:"Loading"}),o=C(()=>J.value[0]);async function F(){l.value=!0,l.text="初始化编解码器中...",a=await ee(),a.setLogger(({type:f,message:t})=>{console.log(f,t)}),l.value=!1}j(o,async()=>{o.value&&(await I(),await $())},{immediate:!0});async function $(){l.value=!0,l.text="正在读取文件...";const f=await ae(o.value.raw);a==null||a.FS("writeFile",o.value.name,f),console.log("视频已读入ffmpeg"),l.value=!1}async function I(){l.value=!0,l.text="获取视频信息中...",(await te(o.value.raw)).media.track.forEach(t=>{const _=t["@type"];_==="Video"?s.value.video={...N(t,["FileSize","DataSize"]),"@type":A.global.t("video")}:_==="Audio"?s.value.audio={...N(t,["FileSize","DataSize"]),"@type":A.global.t("audio")}:_==="General"&&(s.value.basic=N(t,["FileSize","DataSize"]))}),await oe(()=>!!a),l.value=!1}async function r(){await F()}function X(){console.log(123)}async function Y(f){u.loading=!0;try{const{format:t,frameRate:_}=f,V=new le(1e3);V.start(p=>{const h=Number((p*(100-u.percentage)/u.percentage/1e3).toFixed(0));u.tip=`已耗时${p/1e3}秒,预计还需${h}秒`}),a==null||a.setProgress(p=>{const{ratio:h}=p;h>=1&&(V.stop(),u.tip="已完成");const z=Number((h*100).toFixed(1));u.percentage=z});const L=ne({"-i":o.value.name,"-r":`${_}`,"-s":"1920x1080","-b":"1000k","-vf":"hue=s=0","-an":"","-preset":"1"}),w=`${se(o.value.name)}.${t.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",f),await(a==null?void 0:a.run(...L,w));const k=a==null?void 0:a.FS("readFile",w);if(!k)throw new Error("转换失败");ce(k,"video/mp4",w)}catch(t){console.log("%c [ error ]-156","font-size:13px; background:pink; color:#bf2c9f;",t),Fe({message:"转换失败",type:"error"})}u.loading=!1}return r(),(f,t)=>{const _=Ve,V=be,L=Q,w=K,k=W,p=ke,h=he,z=ze,Z=ye;return M((m(),g("div",{class:"video","element-loading-text":l.text},[e(V,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=x=>b.value=x)},{default:n(()=>[e(_,{title:"基本信息",name:"1"},{default:n(()=>[e(T,{data:U(y)},null,8,["data"])]),_:1}),e(_,{title:"视频流信息",name:"2"},{default:n(()=>[e(T,{data:s.value.video},null,8,["data"])]),_:1}),e(_,{title:"音频流信息",name:"3"},{default:n(()=>[e(T,{data:s.value.audio},null,8,["data"])]),_:1})]),_:1},8,["modelValue"]),v("div",Re,[Ae,e(k,{"label-position":"left","label-width":"100px",model:d},{default:n(()=>[e(w,{label:"输出名称"},{default:n(()=>[e(L,{modelValue:d.name,"onUpdate:modelValue":t[1]||(t[1]=x=>d.name=x),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),v("div",De,[e(h,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=x=>c.value=x),onTabClick:X},{default:n(()=>[e(p,{name:"transcoding",label:"转换"},{default:n(()=>[e(Ce,{"on-finish":Y})]),_:1}),e(p,{name:"Config",label:"提取字幕"}),e(p,{name:"Role",label:"提取音频"}),e(p,{name:"waterMark",label:"水印"}),e(p,{name:"screenshot",label:"截图"})]),_:1},8,["modelValue"])]),e(z,ge(ve(u)),null,16)],8,Be)),[[Z,l.value]])}}});const Ge=D(je,[["__scopeId","data-v-ca572197"]]);export{Ge as default};
