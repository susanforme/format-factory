import{i as X,_ as A,T as Y,o as Z,g as q,d as H,a as z,b as B,f as J,c as K,e as ee,h as le,j as ae,k as oe}from"./index-86fdc533.js";import{l as j,c as R,X as O,Y as te,j as m,k as h,u as C,F as N,f as e,p as n,A as y,m as ne,Z as se,_ as re,B as F,z as S,$ as D,a0 as de,v as P,y as M,a1 as ie,a2 as ue,a3 as ce,a4 as pe,a5 as G,a6 as Q,a7 as me,a8 as fe,a9 as W,aa as _e,r as I,w as ge,Q as be,ab as ve,ac as he,P as $e,ad as ke}from"./element-plus-e75c2a1f.js";const we={class:"mask"},Ve={key:0,class:"percentage-value"},ye={key:2,class:"percentage-label"},Fe={class:"tip"},Ee=j({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:null,text:null,percentageLabel:null,tip:null},setup(f){const i=f,c=R(()=>!X(i.percentage)),t=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(d,_)=>{const T=D,l=de;return O((m(),h("div",we,[C(c)?(m(),h(N,{key:0},[e(l,{type:"dashboard",percentage:f.percentage,color:t},{default:n(({percentage:a})=>[a<100?(m(),h("span",Ve,y(a)+"%",1)):(m(),ne(T,{key:1,type:"success",icon:C(se),circle:""},null,8,["icon"])),f.percentageLabel?(m(),h("span",ye,y(f.percentageLabel),1)):re("",!0)]),_:1},8,["percentage"]),F("div",Fe,y(f.tip),1)],64)):(m(),h(N,{key:1},[S("加载中")],64))],512)),[[te,f.loading]])}}});const Te=A(Ee,[["__scopeId","data-v-5de5031d"]]);const Le={class:"config"},Ue={class:"operate"},Ie=j({__name:"Transcoding",props:{encoder:null,file:null,config:null},setup(f){const i=f,c=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],t=P({format:"mp4",kbps:1e3,frameRate:60,width:1920,height:1080,resolution:1080,black:!1,preset:"medium"}),d=P({loading:!1,percentage:0,text:"",tip:""}),_=[{label:"ultrafast",value:"ultrafast"},{label:"superfast",value:"superfast"},{label:"veryfast",value:"veryfast"},{label:"faster",value:"faster"},{label:"fast",value:"fast"},{label:"medium",value:"medium"},{label:"slow",value:"slow"},{label:"slower",value:"slower"},{label:"veryslow",value:"veryslow"}];async function T(){var l,a,w;try{const p=new Y(1e3);p.start(k=>{const E=Number((k*(100-d.percentage)/d.percentage/1e3).toFixed(0));d.tip=`已耗时${k/1e3}秒,预计还需${E}秒`}),d.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",p),(l=i.encoder)==null||l.setProgress(k=>{const{ratio:E}=k;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",k),E>=1&&!k.duration&&(p.stop(),d.tip="转码已完成,正在执行导出操作...");const V=Number((E*100).toFixed(1));d.percentage=V});const{format:u,frameRate:g,width:L,height:s,resolution:r,kbps:b,black:v,preset:o}=t,x=Z({"-i":i.file.name,"-r":`${g}`,"-s":`${L}x${s}`,"-vf":`scale=${r}:-1${v?"":" ,hue=s=0"}`,"-b":`${b}k`,"-preset":o}),U=`${q(i.config.name)}.${u.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",t),await((a=i.encoder)==null?void 0:a.run(...x,U));const $=(w=i.encoder)==null?void 0:w.FS("readFile",U);if(!$)throw new Error("转换失败");H($,"video/mp4",U)}catch(p){console.log("%c [ error ]-156","font-size:13px; background:pink; color:#bf2c9f;",p),ce({message:"转换失败",type:"error"})}d.loading=!1,d.tip=""}return(l,a)=>{const w=_e,p=pe,u=G,g=Q,L=me,s=fe,r=W,b=D,v=Te;return m(),h("div",null,[F("div",Le,[F("h2",null,y(l.$t("trans_config"))+":",1),e(r,{"label-position":"left","label-width":"100px",model:t},{default:n(()=>[e(u,{label:l.$t("output_format")},{default:n(()=>[e(p,{modelValue:t.format,"onUpdate:modelValue":a[0]||(a[0]=o=>t.format=o),filterable:"",placeholder:l.$t("select_placeholder")},{default:n(()=>[(m(),h(N,null,M(c,o=>e(w,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("code_rate")},{default:n(()=>[e(g,{modelValue:t.kbps,"onUpdate:modelValue":a[1]||(a[1]=o=>t.kbps=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("FrameRate")},{default:n(()=>[e(g,{modelValue:t.frameRate,"onUpdate:modelValue":a[2]||(a[2]=o=>t.frameRate=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("width")},{default:n(()=>[e(g,{modelValue:t.width,"onUpdate:modelValue":a[3]||(a[3]=o=>t.width=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("height")},{default:n(()=>[e(g,{modelValue:t.height,"onUpdate:modelValue":a[4]||(a[4]=o=>t.height=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("resolution")},{default:n(()=>[e(g,{modelValue:t.resolution,"onUpdate:modelValue":a[5]||(a[5]=o=>t.resolution=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("is_black")},{default:n(()=>[e(L,{modelValue:t.black,"onUpdate:modelValue":a[6]||(a[6]=o=>t.black=o),placeholder:l.$t("select_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(u,{label:l.$t("output_speed")},{label:n(()=>[e(s,{content:l.$t("output_speed_tip")},{default:n(()=>[S(y(l.$t("output_speed")),1)]),_:1},8,["content"])]),default:n(()=>[e(p,{modelValue:t.preset,"onUpdate:modelValue":a[7]||(a[7]=o=>t.preset=o),placeholder:l.$t("select_placeholder")},{default:n(()=>[(m(),h(N,null,M(_,o=>e(w,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),F("div",Ue,[e(b,{type:"primary",onClick:T},{default:n(()=>[S(y(l.$t("output")),1)]),_:1})]),e(v,ie(ue(d)),null,16)])}}});const Ce=A(Ie,[["__scopeId","data-v-28f695d0"]]),Ne=["element-loading-text"],Pe={class:"config"},xe={class:"operate"},ze=j({__name:"Video",setup(f){const i=P({name:z.global.t("output")}),c=I(null),t=I("transcoding"),d=I("-1"),_=I({audio:{},video:{},basic:{}}),T=R(()=>({file_n:a.value.name,file_s:J(a.value.size),..._.value.basic})),l=P({value:!1,text:"Loading"}),a=R(()=>K.value[0]);async function w(){l.value=!0,l.text="初始化编解码器中...",c.value=await ee(),c==null||c.value.setLogger(({type:s,message:r})=>{console.log(s,r)}),l.value=!1}ge(a,async()=>{a.value&&(await u(),await p())},{immediate:!0});async function p(){var r;l.value=!0,l.text="正在读取文件...";const s=await le(a.value.raw);(r=c.value)==null||r.FS("writeFile",a.value.name,s),console.log("视频已读入ffmpeg"),l.value=!1}async function u(){l.value=!0,l.text="获取视频信息中...";const{raw:s}=a.value,r=await ae(s);for(const b of r.media.track){const{"@type":v,...o}=b;v==="Video"?_.value.video={...o,"@type":z.global.t("video")}:v==="Audio"?_.value.audio={...o,"@type":z.global.t("audio")}:v==="General"&&(_.value.basic=o)}await oe(()=>!!c.value),l.value=!1}async function g(){await w()}function L(){console.log(123)}return g(),(s,r)=>{const b=$e,v=be,o=Q,x=G,U=W,$=ke,k=ve,E=he;return O((m(),h("div",{class:"video","element-loading-text":l.text},[e(v,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=V=>d.value=V)},{default:n(()=>[e(b,{title:s.$t("basic_info"),name:"1"},{default:n(()=>[e(B,{data:C(T)},null,8,["data"])]),_:1},8,["title"]),e(b,{title:s.$t("video_info"),name:"2"},{default:n(()=>[e(B,{data:_.value.video},null,8,["data"])]),_:1},8,["title"]),e(b,{title:s.$t("audio_info"),name:"3"},{default:n(()=>[e(B,{data:_.value.audio},null,8,["data"])]),_:1},8,["title"])]),_:1},8,["modelValue"]),F("div",Pe,[F("h2",null,y(s.$t("common_config"))+":",1),e(U,{"label-position":"left","label-width":"100px",model:i},{default:n(()=>[e(x,{label:s.$t("output_name")},{default:n(()=>[e(o,{modelValue:i.name,"onUpdate:modelValue":r[1]||(r[1]=V=>i.name=V),placeholder:s.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),F("div",xe,[e(k,{modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=V=>t.value=V),onTabClick:L},{default:n(()=>[e($,{name:"transcoding",label:s.$t("trans")},{default:n(()=>[e(Ce,{config:i,encoder:c.value,file:C(a)},null,8,["config","encoder","file"])]),_:1},8,["label"]),e($,{name:"Config",label:s.$t("extract_sub")},null,8,["label"]),e($,{name:"Role",label:s.$t("extract_audio")},null,8,["label"]),e($,{name:"waterMark",label:s.$t("watermark")},null,8,["label"]),e($,{name:"screenshot",label:s.$t("screenshot")},null,8,["label"])]),_:1},8,["modelValue"])])],8,Ne)),[[E,l.value]])}}});const Se=A(ze,[["__scopeId","data-v-6703a99f"]]);export{Se as default};
