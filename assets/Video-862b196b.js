var Y=Object.defineProperty;var Z=(_,o,e)=>o in _?Y(_,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[o]=e;var x=(_,o,e)=>(Z(_,typeof o!="symbol"?o+"":o,e),e);import{_ as ee,i as le,a as O,b as m,T as ae,o as te,g as oe,d as ne,c as C,f as se,e as re,h as ie,j as ce,k as ue}from"./index-7262caf2.js";import{m as j,c as S,_ as G,$ as de,k as f,l as h,F as R,f as l,q as r,C as k,p as A,v as B,a0 as pe,a1 as me,D as E,B as z,a2 as W,a3 as fe,r as U,w as q,y as N,A as D,a4 as _e,a5 as ge,j as ve,a6 as be,a7 as H,a8 as J,a9 as he,aa as we,ab as K,ac as $e,V as ye,ad as Ve,ae as ke,U as Ee,af as Fe}from"./element-plus-c8ced09d.js";const b=class b{static async init(){if(b.instance)return b.instance;{const{createFFmpeg:o}=await ee(()=>import("./index-972a59ba.js").then(u=>u.i),["assets/index-972a59ba.js","assets/element-plus-c8ced09d.js"]),e=o({log:!0,progress:u=>{console.log(u)},workerPath:new URL("/format-factory/assets/ffmpeg-core.worker-dce31a8d.js",self.location).href,corePath:new URL("/format-factory/assets/ffmpeg-core-d22dfcb4.js",self.location).href,wasmPath:new URL("/format-factory/assets/ffmpeg-core-8d85fba8.wasm",self.location).href});return await e.load(),b.instance=e,e}}getInstance(){return b.instance}static destoryFfmpeg(){var o;(o=b.instance)==null||o.exit(),b.instance=null}};x(b,"instance",null);let M=b;const Pe={class:"mask"},Le={key:0,class:"percentage-value"},Te={key:2,class:"percentage-label"},Ie={class:"tip"},Ue=j({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:{},text:{},percentageLabel:{},tip:{}},setup(_){const o=_,e=S(()=>!le(o.percentage)),u=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(g,a)=>{const n=W,i=fe;return G((f(),h("div",Pe,[e.value?(f(),h(R,{key:0},[l(i,{type:"dashboard",percentage:g.percentage,color:u},{default:r(({percentage:s})=>[s<100?(f(),h("span",Le,k(s)+"%",1)):(f(),A(n,{key:1,type:"success",icon:B(pe),circle:""},null,8,["icon"])),g.percentageLabel?(f(),h("span",Te,k(g.percentageLabel),1)):me("",!0)]),_:1},8,["percentage"]),E("div",Ie,k(g.tip),1)],64)):(f(),h(R,{key:1},[z("加载中")],64))],512)),[[de,g.loading]])}}});const Ne=O(Ue,[["__scopeId","data-v-5de5031d"]]);const Re=[{label:m.global.t("ultrafast"),value:"ultrafast"},{label:m.global.t("superfast"),value:"superfast"},{label:m.global.t("veryfast"),value:"veryfast"},{label:m.global.t("faster"),value:"faster"},{label:m.global.t("fast"),value:"fast"},{label:m.global.t("medium"),value:"medium"},{label:m.global.t("slow"),value:"slow"},{label:m.global.t("slower"),value:"slower"},{label:m.global.t("veryslow"),value:"veryslow"}],Ce=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],Se={class:"config"},Ae={class:"operate"},Be=j({__name:"Transcoding",props:{encoder:{},file:{},config:{},info:{}},setup(_){const o=_,e=U({format:"mp4",resolution:1080,black:!1,preset:"medium"});q(o.info,()=>{const{Width:a,Height:n,FrameRate:i}=o.info.video,s={width:Number(a),height:Number(n),frameRate:Number(i)};e.value={...e.value,...s}});const u=N({loading:!1,percentage:0,text:"",tip:""});async function g(){var a,n,i;try{const s=new ae(1e3);s.start(y=>{const F=Number((y*(100-u.percentage)/u.percentage/1e3).toFixed(0));u.tip=`已耗时${y/1e3}秒,预计还需${F}秒`}),u.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",s),(a=o.encoder)==null||a.setProgress(y=>{const{ratio:F}=y;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",y),F>=1&&!y.duration&&(s.stop(),u.tip="转码已完成,正在执行导出操作...");const V=Number((F*100).toFixed(1));u.percentage=V});const{format:p,frameRate:w,width:P,height:L,resolution:T,black:c,preset:d}=e.value,t=te({"-i":o.file.name,"-r":`${w}`,"-s":`${P}x${L}`,"-vf":`scale=${T}:-1${c?"":" ,hue=s=0"}`,"-preset":d}),v=`${oe(o.config.name)}.${p==null?void 0:p.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",e),await((n=o.encoder)==null?void 0:n.run(...t,v));const $=(i=o.encoder)==null?void 0:i.FS("readFile",v);if(!$)throw new Error("转换失败");ne($,"video/mp4",v)}catch(s){console.error(s),ve({message:"转换失败",type:"error"})}u.loading=!1,u.tip=""}return(a,n)=>{const i=$e,s=be,p=H,w=J,P=he,L=we,T=K,c=W,d=Ne;return f(),h("div",null,[E("div",Se,[E("h2",null,k(a.$t("trans_config"))+":",1),l(T,{"label-position":"left","label-width":"100px",model:e.value},{default:r(()=>[l(p,{label:a.$t("output_format")},{default:r(()=>[l(s,{modelValue:e.value.format,"onUpdate:modelValue":n[0]||(n[0]=t=>e.value.format=t),filterable:"",placeholder:a.$t("select_placeholder")},{default:r(()=>[(f(!0),h(R,null,D(B(Ce),t=>(f(),A(i,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("FrameRate")},{default:r(()=>[l(w,{modelValue:e.value.frameRate,"onUpdate:modelValue":n[1]||(n[1]=t=>e.value.frameRate=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("width")},{default:r(()=>[l(w,{modelValue:e.value.width,"onUpdate:modelValue":n[2]||(n[2]=t=>e.value.width=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("height")},{default:r(()=>[l(w,{modelValue:e.value.height,"onUpdate:modelValue":n[3]||(n[3]=t=>e.value.height=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("resolution")},{default:r(()=>[l(w,{modelValue:e.value.resolution,"onUpdate:modelValue":n[4]||(n[4]=t=>e.value.resolution=t),placeholder:a.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("is_black")},{default:r(()=>[l(P,{modelValue:e.value.black,"onUpdate:modelValue":n[5]||(n[5]=t=>e.value.black=t),placeholder:a.$t("select_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("output_speed")},{label:r(()=>[l(L,{content:a.$t("output_speed_tip")},{default:r(()=>[z(k(a.$t("output_speed")),1)]),_:1},8,["content"])]),default:r(()=>[l(s,{modelValue:e.value.preset,"onUpdate:modelValue":n[6]||(n[6]=t=>e.value.preset=t),placeholder:a.$t("select_placeholder")},{default:r(()=>[(f(!0),h(R,null,D(B(Re),t=>(f(),A(i,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),E("div",Ae,[l(c,{type:"primary",onClick:g},{default:r(()=>[z(k(a.$t("output")),1)]),_:1})]),l(d,_e(ge(u)),null,16)])}}});const ze=O(Be,[["__scopeId","data-v-23f9408c"]]),Me=["element-loading-text"],Oe={class:"config"},je={class:"operate"},xe=j({__name:"Video",setup(_){const o=N({name:m.global.t("output")}),e=U(null),u=U("transcoding"),g=U("-1"),a=N({audio:{},video:{},basic:{}}),n=S(()=>({file_n:s.value.name,file_s:se(s.value.size),...a.basic})),i=N({value:!1,text:"Loading"}),s=S(()=>re.value[0]);async function p(){i.value=!0,i.text="初始化编解码器中...",e.value=await M.init(),e==null||e.value.setLogger(({type:c,message:d})=>{console.log(c,d)}),i.value=!1}q(s,async()=>{s.value&&(await P(),await w())},{immediate:!0});async function w(){var d;i.value=!0,i.text="正在读取文件...";const c=await ie(s.value.raw);(d=e.value)==null||d.FS("writeFile",s.value.name,c),console.log("视频已读入ffmpeg"),i.value=!1}async function P(){i.value=!0,i.text="获取视频信息中...";const{raw:c}=s.value,d=await ce(c);for(const t of d.media.track){const{"@type":v,...$}=t;v==="Video"?a.video={...$,"@type":m.global.t("video")}:v==="Audio"?a.audio={...$,"@type":m.global.t("audio")}:v==="General"&&(a.basic=$)}await ue(()=>!!e.value),i.value=!1}async function L(){await p()}function T(){console.log(123)}return L(),(c,d)=>{const t=Ee,v=ye,$=J,y=H,F=K,V=Fe,Q=Ve,X=ke;return G((f(),h("div",{class:"video","element-loading-text":i.text},[l(v,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=I=>g.value=I)},{default:r(()=>[l(t,{title:c.$t("basic_info"),name:"1"},{default:r(()=>[l(C,{data:n.value},null,8,["data"])]),_:1},8,["title"]),l(t,{title:c.$t("video_info"),name:"2"},{default:r(()=>[l(C,{data:a.video},null,8,["data"])]),_:1},8,["title"]),l(t,{title:c.$t("audio_info"),name:"3"},{default:r(()=>[l(C,{data:a.audio},null,8,["data"])]),_:1},8,["title"])]),_:1},8,["modelValue"]),E("div",Oe,[E("h2",null,k(c.$t("common_config"))+":",1),l(F,{"label-position":"left","label-width":"100px",model:o},{default:r(()=>[l(y,{label:c.$t("output_name")},{default:r(()=>[l($,{modelValue:o.name,"onUpdate:modelValue":d[1]||(d[1]=I=>o.name=I),placeholder:c.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),E("div",je,[l(Q,{modelValue:u.value,"onUpdate:modelValue":d[2]||(d[2]=I=>u.value=I),onTabClick:T},{default:r(()=>[l(V,{name:"transcoding",label:c.$t("trans")},{default:r(()=>[l(ze,{config:o,encoder:e.value,file:s.value,info:a},null,8,["config","encoder","file","info"])]),_:1},8,["label"]),l(V,{name:"Config",label:c.$t("extract_sub")},null,8,["label"]),l(V,{name:"Role",label:c.$t("extract_audio")},null,8,["label"]),l(V,{name:"waterMark",label:c.$t("watermark")},null,8,["label"]),l(V,{name:"screenshot",label:c.$t("screenshot")},null,8,["label"])]),_:1},8,["modelValue"])])],8,Me)),[[X,i.value]])}}});const qe=O(xe,[["__scopeId","data-v-d73b6fde"]]);export{qe as default};
