import{i as H,_ as A,a as m,T as J,o as K,g as Q,d as X,b as S,f as Y,c as ee,e as le,h as ae,j as oe,k as te}from"./index-e377d43d.js";import{m as M,c as x,Z as G,_ as ne,k as f,l as h,u as y,F as C,f as e,q as n,B as w,p as z,$ as se,a0 as re,C as k,A as B,a1 as j,a2 as ue,x as N,z as O,a3 as de,a4 as ie,j as ce,a5 as pe,a6 as D,a7 as q,a8 as me,a9 as fe,aa as W,ab as _e,r as U,w as ge,S as be,ac as ve,ad as he,R as $e,ae as Ve}from"./element-plus-becd63b7.js";const we={class:"mask"},ke={key:0,class:"percentage-value"},ye={key:2,class:"percentage-label"},Fe={class:"tip"},Ee=M({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:null,text:null,percentageLabel:null,tip:null},setup(g){const c=g,o=x(()=>!H(c.percentage)),i=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(F,l)=>{const t=j,u=ue;return G((f(),h("div",we,[y(o)?(f(),h(C,{key:0},[e(u,{type:"dashboard",percentage:g.percentage,color:i},{default:n(({percentage:r})=>[r<100?(f(),h("span",ke,w(r)+"%",1)):(f(),z(t,{key:1,type:"success",icon:y(se),circle:""},null,8,["icon"])),g.percentageLabel?(f(),h("span",ye,w(g.percentageLabel),1)):re("",!0)]),_:1},8,["percentage"]),k("div",Fe,w(g.tip),1)],64)):(f(),h(C,{key:1},[B("加载中")],64))],512)),[[ne,g.loading]])}}});const Te=A(Ee,[["__scopeId","data-v-5de5031d"]]);const Ie=[{label:m.global.t("ultrafast"),value:"ultrafast"},{label:m.global.t("superfast"),value:"superfast"},{label:m.global.t("veryfast"),value:"veryfast"},{label:m.global.t("faster"),value:"faster"},{label:m.global.t("fast"),value:"fast"},{label:m.global.t("medium"),value:"medium"},{label:m.global.t("slow"),value:"slow"},{label:m.global.t("slower"),value:"slower"},{label:m.global.t("veryslow"),value:"veryslow"}],Le=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],Pe={class:"config"},Ue={class:"operate"},Ce=M({__name:"Transcoding",props:{encoder:null,file:null,config:null},setup(g){const c=g,o=N({format:"mp4",kbps:1e3,frameRate:60,width:1920,height:1080,resolution:1080,black:!1,preset:"medium"}),i=N({loading:!1,percentage:0,text:"",tip:""});async function F(){var l,t,u;try{const r=new J(1e3);r.start($=>{const _=Number(($*(100-i.percentage)/i.percentage/1e3).toFixed(0));i.tip=`已耗时${$/1e3}秒,预计还需${_}秒`}),i.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",r),(l=c.encoder)==null||l.setProgress($=>{const{ratio:_}=$;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",$),_>=1&&!$.duration&&(r.stop(),i.tip="转码已完成,正在执行导出操作...");const R=Number((_*100).toFixed(1));i.percentage=R});const{format:p,frameRate:b,width:E,height:T,resolution:I,kbps:s,black:d,preset:a}=o,V=K({"-i":c.file.name,"-r":`${b}`,"-s":`${E}x${T}`,"-vf":`scale=${I}:-1${d?"":" ,hue=s=0"}`,"-b":`${s}k`,"-preset":a}),v=`${Q(c.config.name)}.${p.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",o),await((t=c.encoder)==null?void 0:t.run(...V,v));const P=(u=c.encoder)==null?void 0:u.FS("readFile",v);if(!P)throw new Error("转换失败");X(P,"video/mp4",v)}catch(r){console.error(r),ce({message:"转换失败",type:"error"})}i.loading=!1,i.tip=""}return(l,t)=>{const u=_e,r=pe,p=D,b=q,E=me,T=fe,I=W,s=j,d=Te;return f(),h("div",null,[k("div",Pe,[k("h2",null,w(l.$t("trans_config"))+":",1),e(I,{"label-position":"left","label-width":"100px",model:o},{default:n(()=>[e(p,{label:l.$t("output_format")},{default:n(()=>[e(r,{modelValue:o.format,"onUpdate:modelValue":t[0]||(t[0]=a=>o.format=a),filterable:"",placeholder:l.$t("select_placeholder")},{default:n(()=>[(f(!0),h(C,null,O(y(Le),a=>(f(),z(u,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("code_rate")},{default:n(()=>[e(b,{modelValue:o.kbps,"onUpdate:modelValue":t[1]||(t[1]=a=>o.kbps=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("FrameRate")},{default:n(()=>[e(b,{modelValue:o.frameRate,"onUpdate:modelValue":t[2]||(t[2]=a=>o.frameRate=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("width")},{default:n(()=>[e(b,{modelValue:o.width,"onUpdate:modelValue":t[3]||(t[3]=a=>o.width=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("height")},{default:n(()=>[e(b,{modelValue:o.height,"onUpdate:modelValue":t[4]||(t[4]=a=>o.height=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("resolution")},{default:n(()=>[e(b,{modelValue:o.resolution,"onUpdate:modelValue":t[5]||(t[5]=a=>o.resolution=a),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("is_black")},{default:n(()=>[e(E,{modelValue:o.black,"onUpdate:modelValue":t[6]||(t[6]=a=>o.black=a),placeholder:l.$t("select_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{label:l.$t("output_speed")},{label:n(()=>[e(T,{content:l.$t("output_speed_tip")},{default:n(()=>[B(w(l.$t("output_speed")),1)]),_:1},8,["content"])]),default:n(()=>[e(r,{modelValue:o.preset,"onUpdate:modelValue":t[7]||(t[7]=a=>o.preset=a),placeholder:l.$t("select_placeholder")},{default:n(()=>[(f(!0),h(C,null,O(y(Ie),a=>(f(),z(u,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),k("div",Ue,[e(s,{type:"primary",onClick:F},{default:n(()=>[B(w(l.$t("output")),1)]),_:1})]),e(d,de(ie(i)),null,16)])}}});const Ne=A(Ce,[["__scopeId","data-v-c26115fd"]]),Re=["element-loading-text"],Se={class:"config"},xe={class:"operate"},ze=M({__name:"Video",setup(g){const c=N({name:m.global.t("output")}),o=U(null),i=U("transcoding"),F=U("-1"),l=U({audio:{},video:{},basic:{}}),t=x(()=>({file_n:r.value.name,file_s:Y(r.value.size),...l.value.basic})),u=N({value:!1,text:"Loading"}),r=x(()=>ee.value[0]);async function p(){u.value=!0,u.text="初始化编解码器中...",o.value=await le(),o==null||o.value.setLogger(({type:s,message:d})=>{console.log(s,d)}),u.value=!1}ge(r,async()=>{r.value&&(await E(),await b())},{immediate:!0});async function b(){var d;u.value=!0,u.text="正在读取文件...";const s=await ae(r.value.raw);(d=o.value)==null||d.FS("writeFile",r.value.name,s),console.log("视频已读入ffmpeg"),u.value=!1}async function E(){u.value=!0,u.text="获取视频信息中...";const{raw:s}=r.value,d=await oe(s);for(const a of d.media.track){const{"@type":V,...v}=a;V==="Video"?l.value.video={...v,"@type":m.global.t("video")}:V==="Audio"?l.value.audio={...v,"@type":m.global.t("audio")}:V==="General"&&(l.value.basic=v)}await te(()=>!!o.value),u.value=!1}async function T(){await p()}function I(){console.log(123)}return T(),(s,d)=>{const a=$e,V=be,v=q,P=D,$=W,_=Ve,R=ve,Z=he;return G((f(),h("div",{class:"video","element-loading-text":u.text},[e(V,{modelValue:F.value,"onUpdate:modelValue":d[0]||(d[0]=L=>F.value=L)},{default:n(()=>[e(a,{title:s.$t("basic_info"),name:"1"},{default:n(()=>[e(S,{data:y(t)},null,8,["data"])]),_:1},8,["title"]),e(a,{title:s.$t("video_info"),name:"2"},{default:n(()=>[e(S,{data:l.value.video},null,8,["data"])]),_:1},8,["title"]),e(a,{title:s.$t("audio_info"),name:"3"},{default:n(()=>[e(S,{data:l.value.audio},null,8,["data"])]),_:1},8,["title"])]),_:1},8,["modelValue"]),k("div",Se,[k("h2",null,w(s.$t("common_config"))+":",1),e($,{"label-position":"left","label-width":"100px",model:c},{default:n(()=>[e(P,{label:s.$t("output_name")},{default:n(()=>[e(v,{modelValue:c.name,"onUpdate:modelValue":d[1]||(d[1]=L=>c.name=L),placeholder:s.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),k("div",xe,[e(R,{modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=L=>i.value=L),onTabClick:I},{default:n(()=>[e(_,{name:"transcoding",label:s.$t("trans")},{default:n(()=>[e(Ne,{config:c,encoder:o.value,file:y(r)},null,8,["config","encoder","file"])]),_:1},8,["label"]),e(_,{name:"Config",label:s.$t("extract_sub")},null,8,["label"]),e(_,{name:"Role",label:s.$t("extract_audio")},null,8,["label"]),e(_,{name:"waterMark",label:s.$t("watermark")},null,8,["label"]),e(_,{name:"screenshot",label:s.$t("screenshot")},null,8,["label"])]),_:1},8,["modelValue"])])],8,Re)),[[Z,u.value]])}}});const Me=A(ze,[["__scopeId","data-v-6703a99f"]]);export{Me as default};
