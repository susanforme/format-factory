import{i as Y,_ as A,a as u,T as Z,o as q,g as H,d as J,b as R,f as K,c as X,e as ee,h as le,j as ae,k as oe}from"./index-e1e8d8cc.js";import{l as j,c as B,Y as O,Z as te,j as f,k as $,u as N,F as P,f as e,p as n,A as F,m as ne,_ as se,$ as re,B as E,z as S,a0 as D,a1 as ce,v as x,y as M,a2 as de,a3 as ie,a4 as ue,a5 as pe,a6 as G,a7 as Q,a8 as me,a9 as fe,aa as W,ab as _e,r as C,w as be,R as ge,ac as ve,ad as he,Q as $e,ae as ke}from"./element-plus-3b486465.js";const we={class:"mask"},Ve={key:0,class:"percentage-value"},ye={key:2,class:"percentage-label"},Fe={class:"tip"},Ee=j({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:null,text:null,percentageLabel:null,tip:null},setup(_){const d=_,p=B(()=>!Y(d.percentage)),t=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(c,b)=>{const L=D,l=ce;return O((f(),$("div",we,[N(p)?(f(),$(P,{key:0},[e(l,{type:"dashboard",percentage:_.percentage,color:t},{default:n(({percentage:a})=>[a<100?(f(),$("span",Ve,F(a)+"%",1)):(f(),ne(L,{key:1,type:"success",icon:N(se),circle:""},null,8,["icon"])),_.percentageLabel?(f(),$("span",ye,F(_.percentageLabel),1)):re("",!0)]),_:1},8,["percentage"]),E("div",Fe,F(_.tip),1)],64)):(f(),$(P,{key:1},[S("加载中")],64))],512)),[[te,_.loading]])}}});const Te=A(Ee,[["__scopeId","data-v-5de5031d"]]);const Le={class:"config"},Ue={class:"operate"},Ie=j({__name:"Transcoding",props:{encoder:null,file:null,config:null},setup(_){const d=_,p=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],t=x({format:"mp4",kbps:1e3,frameRate:60,width:1920,height:1080,resolution:1080,black:!1,preset:"medium"}),c=x({loading:!1,percentage:0,text:"",tip:""}),b=[{label:u.global.t("ultrafast"),value:"ultrafast"},{label:u.global.t("superfast"),value:"superfast"},{label:u.global.t("veryfast"),value:"veryfast"},{label:u.global.t("faster"),value:"faster"},{label:u.global.t("fast"),value:"fast"},{label:u.global.t("medium"),value:"medium"},{label:u.global.t("slow"),value:"slow"},{label:u.global.t("slower"),value:"slower"},{label:u.global.t("veryslow"),value:"veryslow"}];async function L(){var l,a,V;try{const m=new Z(1e3);m.start(w=>{const T=Number((w*(100-c.percentage)/c.percentage/1e3).toFixed(0));c.tip=`已耗时${w/1e3}秒,预计还需${T}秒`}),c.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",m),(l=d.encoder)==null||l.setProgress(w=>{const{ratio:T}=w;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",w),T>=1&&!w.duration&&(m.stop(),c.tip="转码已完成,正在执行导出操作...");const y=Number((T*100).toFixed(1));c.percentage=y});const{format:i,frameRate:g,width:U,height:s,resolution:r,kbps:v,black:h,preset:o}=t,z=q({"-i":d.file.name,"-r":`${g}`,"-s":`${U}x${s}`,"-vf":`scale=${r}:-1${h?"":" ,hue=s=0"}`,"-b":`${v}k`,"-preset":o}),I=`${H(d.config.name)}.${i.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",t),await((a=d.encoder)==null?void 0:a.run(...z,I));const k=(V=d.encoder)==null?void 0:V.FS("readFile",I);if(!k)throw new Error("转换失败");J(k,"video/mp4",I)}catch(m){console.log("%c [ error ]-156","font-size:13px; background:pink; color:#bf2c9f;",m),ue({message:"转换失败",type:"error"})}c.loading=!1,c.tip=""}return(l,a)=>{const V=_e,m=pe,i=G,g=Q,U=me,s=fe,r=W,v=D,h=Te;return f(),$("div",null,[E("div",Le,[E("h2",null,F(l.$t("trans_config"))+":",1),e(r,{"label-position":"left","label-width":"100px",model:t},{default:n(()=>[e(i,{label:l.$t("output_format")},{default:n(()=>[e(m,{modelValue:t.format,"onUpdate:modelValue":a[0]||(a[0]=o=>t.format=o),filterable:"",placeholder:l.$t("select_placeholder")},{default:n(()=>[(f(),$(P,null,M(p,o=>e(V,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("code_rate")},{default:n(()=>[e(g,{modelValue:t.kbps,"onUpdate:modelValue":a[1]||(a[1]=o=>t.kbps=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("FrameRate")},{default:n(()=>[e(g,{modelValue:t.frameRate,"onUpdate:modelValue":a[2]||(a[2]=o=>t.frameRate=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("width")},{default:n(()=>[e(g,{modelValue:t.width,"onUpdate:modelValue":a[3]||(a[3]=o=>t.width=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("height")},{default:n(()=>[e(g,{modelValue:t.height,"onUpdate:modelValue":a[4]||(a[4]=o=>t.height=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("resolution")},{default:n(()=>[e(g,{modelValue:t.resolution,"onUpdate:modelValue":a[5]||(a[5]=o=>t.resolution=o),placeholder:l.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("is_black")},{default:n(()=>[e(U,{modelValue:t.black,"onUpdate:modelValue":a[6]||(a[6]=o=>t.black=o),placeholder:l.$t("select_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:l.$t("output_speed")},{label:n(()=>[e(s,{content:l.$t("output_speed_tip")},{default:n(()=>[S(F(l.$t("output_speed")),1)]),_:1},8,["content"])]),default:n(()=>[e(m,{modelValue:t.preset,"onUpdate:modelValue":a[7]||(a[7]=o=>t.preset=o),placeholder:l.$t("select_placeholder")},{default:n(()=>[(f(),$(P,null,M(b,o=>e(V,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),E("div",Ue,[e(v,{type:"primary",onClick:L},{default:n(()=>[S(F(l.$t("output")),1)]),_:1})]),e(h,de(ie(c)),null,16)])}}});const Ce=A(Ie,[["__scopeId","data-v-db710eca"]]),Ne=["element-loading-text"],Pe={class:"config"},xe={class:"operate"},ze=j({__name:"Video",setup(_){const d=x({name:u.global.t("output")}),p=C(null),t=C("transcoding"),c=C("-1"),b=C({audio:{},video:{},basic:{}}),L=B(()=>({file_n:a.value.name,file_s:K(a.value.size),...b.value.basic})),l=x({value:!1,text:"Loading"}),a=B(()=>X.value[0]);async function V(){l.value=!0,l.text="初始化编解码器中...",p.value=await ee(),p==null||p.value.setLogger(({type:s,message:r})=>{console.log(s,r)}),l.value=!1}be(a,async()=>{a.value&&(await i(),await m())},{immediate:!0});async function m(){var r;l.value=!0,l.text="正在读取文件...";const s=await le(a.value.raw);(r=p.value)==null||r.FS("writeFile",a.value.name,s),console.log("视频已读入ffmpeg"),l.value=!1}async function i(){l.value=!0,l.text="获取视频信息中...";const{raw:s}=a.value,r=await ae(s);for(const v of r.media.track){const{"@type":h,...o}=v;h==="Video"?b.value.video={...o,"@type":u.global.t("video")}:h==="Audio"?b.value.audio={...o,"@type":u.global.t("audio")}:h==="General"&&(b.value.basic=o)}await oe(()=>!!p.value),l.value=!1}async function g(){await V()}function U(){console.log(123)}return g(),(s,r)=>{const v=$e,h=ge,o=Q,z=G,I=W,k=ke,w=ve,T=he;return O((f(),$("div",{class:"video","element-loading-text":l.text},[e(h,{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=y=>c.value=y)},{default:n(()=>[e(v,{title:s.$t("basic_info"),name:"1"},{default:n(()=>[e(R,{data:N(L)},null,8,["data"])]),_:1},8,["title"]),e(v,{title:s.$t("video_info"),name:"2"},{default:n(()=>[e(R,{data:b.value.video},null,8,["data"])]),_:1},8,["title"]),e(v,{title:s.$t("audio_info"),name:"3"},{default:n(()=>[e(R,{data:b.value.audio},null,8,["data"])]),_:1},8,["title"])]),_:1},8,["modelValue"]),E("div",Pe,[E("h2",null,F(s.$t("common_config"))+":",1),e(I,{"label-position":"left","label-width":"100px",model:d},{default:n(()=>[e(z,{label:s.$t("output_name")},{default:n(()=>[e(o,{modelValue:d.name,"onUpdate:modelValue":r[1]||(r[1]=y=>d.name=y),placeholder:s.$t("text_placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),E("div",xe,[e(w,{modelValue:t.value,"onUpdate:modelValue":r[2]||(r[2]=y=>t.value=y),onTabClick:U},{default:n(()=>[e(k,{name:"transcoding",label:s.$t("trans")},{default:n(()=>[e(Ce,{config:d,encoder:p.value,file:N(a)},null,8,["config","encoder","file"])]),_:1},8,["label"]),e(k,{name:"Config",label:s.$t("extract_sub")},null,8,["label"]),e(k,{name:"Role",label:s.$t("extract_audio")},null,8,["label"]),e(k,{name:"waterMark",label:s.$t("watermark")},null,8,["label"]),e(k,{name:"screenshot",label:s.$t("screenshot")},null,8,["label"])]),_:1},8,["modelValue"])])],8,Ne)),[[T,l.value]])}}});const Se=A(ze,[["__scopeId","data-v-6703a99f"]]);export{Se as default};
