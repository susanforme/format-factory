import{i as Z,_ as A,a as P,f as q,b as H,c as J,d as ee,g as ae,e as z,h as te,T as oe,o as le,j as ne,k as se}from"./index-198cab7e.js";import{l as R,r as $,w as j,c as S,X as M,Y as ce,j as m,k as g,u as U,F as B,f as e,p as l,A as C,m as ie,Z as re,_ as de,B as y,z as O,$ as D,a0 as ue,v as I,y as pe,a1 as _e,a2 as G,a3 as K,a4 as Q,a5 as me,a6 as fe,a7 as ge,Q as ve,a8 as be,a9 as ye,K as he,L as we,aa as ke,P as xe,ab as Ve}from"./element-plus-7482c9d6.js";const Fe={class:"mask"},Ee={key:0,class:"percentage-value"},$e={key:2,class:"percentage-label"},Ie={class:"tip"},Le=R({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:null,text:null,percentageLabel:null,tip:null},setup(i){const d=i,a=$(!1);j(()=>d.loading,()=>{d.loading&&(a.value=!0),setTimeout(()=>{d.loading||(a.value=!1)},1e3)},{immediate:!0});const c=S(()=>!Z(d.percentage)),h=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(u,n)=>{const k=D,o=ue;return M((m(),g("div",Fe,[U(c)?(m(),g(B,{key:0},[e(o,{type:"dashboard",percentage:i.percentage,color:h},{default:l(({percentage:t})=>[t<100?(m(),g("span",Ee,C(t)+"%",1)):(m(),ie(k,{key:1,type:"success",icon:U(re),circle:""},null,8,["icon"])),i.percentageLabel?(m(),g("span",$e,C(i.percentageLabel),1)):de("",!0)]),_:1},8,["percentage"]),y("div",Ie,C(i.tip),1)],64)):(m(),g(B,{key:1},[O("加载中")],64))],512)),[[ce,a.value]])}}});const Te=A(Le,[["__scopeId","data-v-d78ca4be"]]);const Ne={class:"config"},Pe=y("h2",null,"转换配置:",-1),Ce={class:"operate"},Se=R({__name:"Transcoding",props:{onFinish:{type:Function}},setup(i){const d=i,a=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],c=I({format:"mp4",kbps:1e3,frameRate:60});function h(){d.onFinish(c)}return(u,n)=>{const k=me,o=_e,t=G,F=K,L=Q,T=D;return m(),g("div",null,[y("div",Ne,[Pe,e(L,{"label-position":"left","label-width":"100px",model:c},{default:l(()=>[e(t,{label:"输出格式"},{default:l(()=>[e(o,{modelValue:c.format,"onUpdate:modelValue":n[0]||(n[0]=r=>c.format=r),filterable:"",placeholder:"请选择"},{default:l(()=>[(m(),g(B,null,pe(a,r=>e(k,{key:r,label:r,value:r},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(t,{label:"码率"},{default:l(()=>[e(F,{modelValue:c.kbps,"onUpdate:modelValue":n[1]||(n[1]=r=>c.kbps=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(t,{label:"帧率"},{default:l(()=>[e(F,{modelValue:c.frameRate,"onUpdate:modelValue":n[2]||(n[2]=r=>c.frameRate=r),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),y("div",Ce,[e(T,{type:"primary",onClick:h},{default:l(()=>[O(" 输出 ")]),_:1})])])}}}),Ue=i=>(he("data-v-7df3f2cf"),i=i(),we(),i),Be=["element-loading-text"],Re={class:"config"},ze=Ue(()=>y("h2",null,"通用导出配置:",-1)),Ae={class:"operate"},je=R({__name:"Video",setup(i){const d=I({name:"output"});let a=null;const c=$("transcoding"),h=$("-1"),u=I({loading:!1,percentage:0,text:"",tip:""}),n=$({audio:{},video:{},basic:{}}),k=S(()=>({file_n:t.value.name,file_s:q(t.value.size),...n.value.basic})),o=I({value:!1,text:"Loading"}),t=S(()=>H.value[0]);async function F(){o.value=!0,o.text="初始化编解码器中...",a=await J(),a.setLogger(({type:_,message:s})=>{console.log(_,s)}),o.value=!1}j(t,async()=>{t.value&&(await T(),await L())},{immediate:!0});async function L(){o.value=!0,o.text="正在读取文件...";const _=await ee(t.value.raw);a==null||a.FS("writeFile",t.value.name,_),console.log("视频已读入ffmpeg"),o.value=!1}async function T(){o.value=!0,o.text="获取视频信息中...";const{raw:_}=t.value,s=await ae(_);for(const v of s.media.track){const{"@type":f,...b}=v;f==="Video"?n.value.video={...b,"@type":z.global.t("video")}:f==="Audio"?n.value.audio={...b,"@type":z.global.t("audio")}:f==="General"&&(n.value.basic=b)}await te(()=>!!a),o.value=!1}async function r(){await F()}function W(){console.log(123)}async function X(_){u.loading=!0;try{const{format:s,frameRate:v}=_,f=new oe(1e3);f.start(p=>{const w=Number((p*(100-u.percentage)/u.percentage/1e3).toFixed(0));u.tip=`已耗时${p/1e3}秒,预计还需${w}秒`}),a==null||a.setProgress(p=>{const{ratio:w}=p;w>=1&&(f.stop(),u.tip="已完成");const N=Number((w*100).toFixed(1));u.percentage=N});const b=le({"-i":t.value.name,"-r":`${v}`,"-s":"1920x1080","-b":"1000k","-vf":"hue=s=0","-an":"","-preset":"1"}),x=`${ne(t.value.name)}.${s.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",_),await(a==null?void 0:a.run(...b,x));const E=a==null?void 0:a.FS("readFile",x);if(!E)throw new Error("转换失败");se(E,"video/mp4",x)}catch(s){console.log("%c [ error ]-156","font-size:13px; background:pink; color:#bf2c9f;",s),ke({message:"转换失败",type:"error"})}u.loading=!1}return r(),(_,s)=>{const v=xe,f=ve,b=K,x=G,E=Q,p=Ve,w=be,N=Te,Y=ye;return M((m(),g("div",{class:"video","element-loading-text":o.text},[e(f,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=V=>h.value=V)},{default:l(()=>[e(v,{title:"基本信息",name:"1"},{default:l(()=>[e(P,{data:U(k)},null,8,["data"])]),_:1}),e(v,{title:"视频流信息",name:"2"},{default:l(()=>[e(P,{data:n.value.video},null,8,["data"])]),_:1}),e(v,{title:"音频流信息",name:"3"},{default:l(()=>[e(P,{data:n.value.audio},null,8,["data"])]),_:1})]),_:1},8,["modelValue"]),y("div",Re,[ze,e(E,{"label-position":"left","label-width":"100px",model:d},{default:l(()=>[e(x,{label:"输出名称"},{default:l(()=>[e(b,{modelValue:d.name,"onUpdate:modelValue":s[1]||(s[1]=V=>d.name=V),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),y("div",Ae,[e(w,{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=V=>c.value=V),onTabClick:W},{default:l(()=>[e(p,{name:"transcoding",label:"转换"},{default:l(()=>[e(Se,{"on-finish":X})]),_:1}),e(p,{name:"Config",label:"提取字幕"}),e(p,{name:"Role",label:"提取音频"}),e(p,{name:"waterMark",label:"水印"}),e(p,{name:"screenshot",label:"截图"})]),_:1},8,["modelValue"])]),e(N,fe(ge(u)),null,16)],8,Be)),[[Y,o.value]])}}});const De=A(je,[["__scopeId","data-v-7df3f2cf"]]);export{De as default};
