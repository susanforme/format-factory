import{i as Y,_ as R,T as Z,o as q,g as H,d as J,a as P,f as ee,b as le,c as ae,e as oe,h as te,j,k as ne}from"./index-e9c3ec5e.js";import{l as A,c as z,X as O,Y as se,j as _,k as w,u as T,F as U,f as e,p as t,A as S,m as ce,Z as ie,_ as re,B as x,z as B,$ as D,a0 as de,v as C,y as M,a1 as ue,a2 as pe,a3 as me,a4 as _e,a5 as G,a6 as K,a7 as fe,a8 as ge,a9 as Q,K as W,L as X,aa as ve,r as L,w as be,Q as we,ab as Ve,ac as ke,P as ye,ad as he}from"./element-plus-e75c2a1f.js";const xe={class:"mask"},$e={key:0,class:"percentage-value"},Fe={key:2,class:"percentage-label"},Ee={class:"tip"},Ie=A({__name:"ProgressLoading",props:{loading:{type:Boolean},percentage:null,text:null,percentageLabel:null,tip:null},setup(n){const i=n,u=z(()=>!Y(i.percentage)),o=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#6f7ad3",percentage:60},{color:"#1989fa",percentage:80},{color:"#5cb87a",percentage:100}];return(r,f)=>{const F=D,s=de;return O((_(),w("div",xe,[T(u)?(_(),w(U,{key:0},[e(s,{type:"dashboard",percentage:n.percentage,color:o},{default:t(({percentage:l})=>[l<100?(_(),w("span",$e,S(l)+"%",1)):(_(),ce(F,{key:1,type:"success",icon:T(ie),circle:""},null,8,["icon"])),n.percentageLabel?(_(),w("span",Fe,S(n.percentageLabel),1)):re("",!0)]),_:1},8,["percentage"]),x("div",Ee,S(n.tip),1)],64)):(_(),w(U,{key:1},[B("加载中")],64))],512)),[[se,n.loading]])}}});const Le=R(Ie,[["__scopeId","data-v-5de5031d"]]);const Te=n=>(W("data-v-a3b3f256"),n=n(),X(),n),Ue={class:"config"},Ce=Te(()=>x("h2",null,"转换配置:",-1)),Ne={class:"operate"},Pe=A({__name:"Transcoding",props:{encoder:null,file:null,config:null},setup(n){const i=n,u=["mp4","webm","ogg","avi","mov","flv","wmv","mkv","m4v","3gp","3g2","ts","mts","m2ts","vob","mxf","f4v"],o=C({format:"mp4",kbps:1e3,frameRate:60,width:1920,height:1080,resolution:1080,black:!1,preset:"medium"}),r=C({loading:!1,percentage:0,text:"",tip:""}),f=[{label:"ultrafast",value:"ultrafast"},{label:"superfast",value:"superfast"},{label:"veryfast",value:"veryfast"},{label:"faster",value:"faster"},{label:"fast",value:"fast"},{label:"medium",value:"medium"},{label:"slow",value:"slow"},{label:"slower",value:"slower"},{label:"veryslow",value:"veryslow"}];async function F(){var s,l,k;try{const p=new Z(1e3);p.start(y=>{const $=Number((y*(100-r.percentage)/r.percentage/1e3).toFixed(0));r.tip=`已耗时${y/1e3}秒,预计还需${$}秒`}),r.loading=!0,console.log("%c [ timer ]-106","font-size:13px; background:pink; color:#bf2c9f;",p),(s=i.encoder)==null||s.setProgress(y=>{const{ratio:$}=y;console.log("%c [ progress ]-121","font-size:13px; background:pink; color:#bf2c9f;",y),$>=1&&(p.stop(),r.tip="转码已完成,正在执行导出操作...");const h=Number(($*100).toFixed(1));r.percentage=h});const{format:d,frameRate:g,width:E,height:m,resolution:c,kbps:v,black:b,preset:a}=o,N=q({"-i":i.file.name,"-r":`${g}`,"-s":`${E}x${m}`,"-vf":`scale=${c}:-1${b?"":" ,hue=s=0"}`,"-b":`${v}k`,"-preset":a}),I=`${H(i.config.name)}.${d.toLowerCase()}`;console.log("%c [ config ]-70","font-size:13px; background:pink; color:#bf2c9f;",o),await((l=i.encoder)==null?void 0:l.run(...N,I));const V=(k=i.encoder)==null?void 0:k.FS("readFile",I);if(!V)throw new Error("转换失败");J(V,"video/mp4",I)}catch(p){console.log("%c [ error ]-156","font-size:13px; background:pink; color:#bf2c9f;",p),me({message:"转换失败",type:"error"})}r.loading=!1}return(s,l)=>{const k=ve,p=_e,d=G,g=K,E=fe,m=ge,c=Q,v=D,b=Le;return _(),w("div",null,[x("div",Ue,[Ce,e(c,{"label-position":"left","label-width":"100px",model:o},{default:t(()=>[e(d,{label:"输出格式"},{default:t(()=>[e(p,{modelValue:o.format,"onUpdate:modelValue":l[0]||(l[0]=a=>o.format=a),filterable:"",placeholder:"请选择"},{default:t(()=>[(_(),w(U,null,M(u,a=>e(k,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"码率"},{default:t(()=>[e(g,{modelValue:o.kbps,"onUpdate:modelValue":l[1]||(l[1]=a=>o.kbps=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"帧率"},{default:t(()=>[e(g,{modelValue:o.frameRate,"onUpdate:modelValue":l[2]||(l[2]=a=>o.frameRate=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"宽"},{default:t(()=>[e(g,{modelValue:o.width,"onUpdate:modelValue":l[3]||(l[3]=a=>o.width=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"高"},{default:t(()=>[e(g,{modelValue:o.height,"onUpdate:modelValue":l[4]||(l[4]=a=>o.height=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"清晰度"},{default:t(()=>[e(g,{modelValue:o.resolution,"onUpdate:modelValue":l[5]||(l[5]=a=>o.resolution=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"是否黑白"},{default:t(()=>[e(E,{modelValue:o.black,"onUpdate:modelValue":l[6]||(l[6]=a=>o.black=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(d,{label:"输出速度"},{label:t(()=>[e(m,{content:"输出速度越快,质量越低"},{default:t(()=>[B(" 输出速度 ")]),_:1})]),default:t(()=>[e(p,{modelValue:o.preset,"onUpdate:modelValue":l[7]||(l[7]=a=>o.preset=a),placeholder:"请输入"},{default:t(()=>[(_(),w(U,null,M(f,a=>e(k,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),x("div",Ne,[e(v,{type:"primary",onClick:F},{default:t(()=>[B(" 输出 ")]),_:1})]),e(b,ue(pe(r)),null,16)])}}});const Se=R(Pe,[["__scopeId","data-v-a3b3f256"]]),ze=n=>(W("data-v-4b2e0732"),n=n(),X(),n),Be=["element-loading-text"],Re={class:"config"},Ae=ze(()=>x("h2",null,"通用导出配置:",-1)),je={class:"operate"},Me=A({__name:"Video",setup(n){const i=C({name:"输出"}),u=L(null),o=L("transcoding"),r=L("-1"),f=L({audio:{},video:{},basic:{}}),F=z(()=>({file_n:l.value.name,file_s:ee(l.value.size),...f.value.basic})),s=C({value:!1,text:"Loading"}),l=z(()=>le.value[0]);async function k(){s.value=!0,s.text="初始化编解码器中...",u.value=await ae(),u==null||u.value.setLogger(({type:m,message:c})=>{console.log(m,c)}),s.value=!1}be(l,async()=>{l.value&&(await d(),await p())},{immediate:!0});async function p(){var c;s.value=!0,s.text="正在读取文件...";const m=await oe(l.value.raw);(c=u.value)==null||c.FS("writeFile",l.value.name,m),console.log("视频已读入ffmpeg"),s.value=!1}async function d(){s.value=!0,s.text="获取视频信息中...";const{raw:m}=l.value,c=await te(m);for(const v of c.media.track){const{"@type":b,...a}=v;b==="Video"?f.value.video={...a,"@type":j.global.t("video")}:b==="Audio"?f.value.audio={...a,"@type":j.global.t("audio")}:b==="General"&&(f.value.basic=a)}await ne(()=>!!u.value),s.value=!1}async function g(){await k()}function E(){console.log(123)}return g(),(m,c)=>{const v=ye,b=we,a=K,N=G,I=Q,V=he,y=Ve,$=ke;return O((_(),w("div",{class:"video","element-loading-text":s.text},[e(b,{modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=h=>r.value=h)},{default:t(()=>[e(v,{title:"基本信息",name:"1"},{default:t(()=>[e(P,{data:T(F)},null,8,["data"])]),_:1}),e(v,{title:"视频流信息",name:"2"},{default:t(()=>[e(P,{data:f.value.video},null,8,["data"])]),_:1}),e(v,{title:"音频流信息",name:"3"},{default:t(()=>[e(P,{data:f.value.audio},null,8,["data"])]),_:1})]),_:1},8,["modelValue"]),x("div",Re,[Ae,e(I,{"label-position":"left","label-width":"100px",model:i},{default:t(()=>[e(N,{label:"输出名称"},{default:t(()=>[e(a,{modelValue:i.name,"onUpdate:modelValue":c[1]||(c[1]=h=>i.name=h),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),x("div",je,[e(y,{modelValue:o.value,"onUpdate:modelValue":c[2]||(c[2]=h=>o.value=h),onTabClick:E},{default:t(()=>[e(V,{name:"transcoding",label:"转换"},{default:t(()=>[e(Se,{config:i,encoder:u.value,file:T(l)},null,8,["config","encoder","file"])]),_:1}),e(V,{name:"Config",label:"提取字幕"}),e(V,{name:"Role",label:"提取音频"}),e(V,{name:"waterMark",label:"水印"}),e(V,{name:"screenshot",label:"截图"})]),_:1},8,["modelValue"])])],8,Be)),[[$,s.value]])}}});const Ge=R(Me,[["__scopeId","data-v-4b2e0732"]]);export{Ge as default};
